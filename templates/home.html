<!-- templates/home.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ›ãƒ¼ãƒ  | Ishikawa Facilities & Parks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap 5ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»–ãƒšãƒ¼ã‚¸ã«åˆã‚ã›ã¦ãã ã•ã„ï¼‰ -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8fafc; }
    .card { border: 0; border-radius: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.06); transition: transform .1s ease; }
    .card:hover { transform: translateY(-3px); }
    .card .icon { font-size: 2.2rem; line-height: 1; }
    .grid { display: grid; gap: 1rem; grid-template-columns: repeat(1,minmax(0,1fr)); }
    @media (min-width: 768px) { .grid { grid-template-columns: repeat(2,minmax(0,1fr)); } }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-white border-bottom">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/home">Ishikawa Facilities & Parks</a>
      <div class="ms-auto">
        <span class="me-3 text-muted">
          ã‚ˆã†ã“ãã€{{ user.display_name or user.email }}
        </span>
        <a class="btn btn-outline-secondary btn-sm" href="/auth/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
      </div>
    </div>
  </nav>
  <audio id="bgmAudio" loop>
    <source src="/static/bgm/home_bgm.mp3" type="audio/mpeg">
    <!-- ã“ã“ã«å¯¾å¿œã—ã¦ãªã„ãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›¸ã„ã¦ã‚‚OK -->
  </audio>

  <!-- â˜… ã©ã“ã‹ã®ç›®ç«‹ã¤å ´æ‰€ã« BGM ãƒœã‚¿ãƒ³ï¼ˆä¾‹: ãƒšãƒ¼ã‚¸å³ä¸Šãªã©ï¼‰ -->
  <div style="position: fixed; right: 1rem; bottom: 1rem; z-index: 2000;">
    <button id="bgmToggleBtn" class="btn btn-sm btn-outline-primary">
      ğŸµ BGM ON
    </button>
  </div>

  <main class="container py-4">
    <div class="mb-4">
      <h1 class="h3 mb-1">ãƒ›ãƒ¼ãƒ </h1>
      <p class="text-muted mb-0">
        å¯¾æˆ¦ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã¶ã‹ã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œå•ã€ãƒãƒƒãƒ—ã§ã‚¹ã‚¿ãƒ³ãƒ—é›†ã‚ã¸ã©ã†ãã€‚
      </p>
    </div>

    <div class="grid">
      <!-- ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ -->
      <div class="card">
        <div class="card-body d-flex align-items-start">
          <div class="icon me-3">ğŸ®</div>
          <div class="flex-grow-1">
            <h2 class="h5 mb-1">ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ</h2>
            <p class="text-muted mb-3">ã™ãã«å¯¾æˆ¦ã‚’é–‹å§‹ã—ã¾ã™ï¼ˆè‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°ï¼‰ã€‚</p>
            <a href="/quiz/random" class="btn btn-primary">å¯¾æˆ¦ã‚’ã¯ã˜ã‚ã‚‹</a>
          </div>
        </div>
      </div>

      <!-- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒï¼ˆéƒ¨å±‹ä½œæˆ/å‚åŠ ï¼‰ -->
      <div class="card">
        <div class="card-body d-flex align-items-start">
          <div class="icon me-3">ğŸ‘¥</div>
          <div class="flex-grow-1">
            <h2 class="h5 mb-1">ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ</h2>
            <p class="text-muted mb-3">éƒ¨å±‹ã‚’ä½œæˆã—ã¦å‹ã ã¡ã¨éŠã¶ã€‚ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã§åˆæµã€‚</p>
            <div class="d-flex gap-2">
              <a href="/quiz/room/new" class="btn btn-success">éƒ¨å±‹ã‚’ä½œæˆ</a>
              <a href="/quiz/room/join" class="btn btn-outline-success">éƒ¨å±‹ã«å‚åŠ </a>
            </div>
          </div>
        </div>
      </div>

      <!-- æ‰€æŒã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ -->
      <div class="card">
        <div class="card-body d-flex align-items-start">
          <div class="icon me-3">ğŸ¦«</div>
          <div class="flex-grow-1">
            <h2 class="h5 mb-1">æ‰€æŒã‚¹ã‚¿ãƒ³ãƒ—</h2>
            <p class="text-muted mb-3">ãƒãƒ¼ãƒ¢ãƒƒãƒˆãªã©ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã€‚</p>
            <a href="/chars" class="btn btn-outline-primary">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã‚‹</a>
          </div>
        </div>
      </div>

      <!-- ä½œå•ãƒšãƒ¼ã‚¸ -->
      <div class="card">
        <div class="card-body d-flex align-items-start">
          <div class="icon me-3">âœï¸</div>
          <div class="flex-grow-1">
            <h2 class="h5 mb-1">ä½œå•</h2>
            <p class="text-muted mb-3">æ–°ã—ã„ã‚¯ã‚¤ã‚ºå•é¡Œã‚’ä½œã£ã¦å…¬é–‹ã—ã‚ˆã†ã€‚</p>
            <a href="/quiz/maker" class="btn btn-outline-dark">ä½œå•ãƒšãƒ¼ã‚¸ã¸</a>
          </div>
        </div>
      </div>

      <!-- â˜… ãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆ -->
      <div class="card">
        <div class="card-body d-flex align-items-start">
          <div class="icon me-3">ğŸ“</div>
          <div class="flex-grow-1">
            <h2 class="h5 mb-1">ãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆ</h2>
            <p class="text-muted mb-3">åœ°å›³ã§ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã—ã¦ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã‚ˆã†ã€‚</p>
            <!-- index.html ã‚’è¿”ã™ãƒ«ãƒ¼ãƒˆï¼ˆ/mapï¼‰ã¸ -->
            <a href="/map" class="btn btn-outline-primary">ãƒãƒƒãƒ—ã‚’é–‹ã</a>
          </div>
        </div>
      </div>

      <!-- åå‰ã®æ±ºå®šãƒ»å¤‰æ›´ -->
      <div class="card">
        <div class="card-body d-flex align-items-start">
          <div class="icon me-3">ğŸ·ï¸</div>
          <div class="flex-grow-1">
            <h2 class="h5 mb-1">åå‰ã®æ±ºå®šãƒ»å¤‰æ›´</h2>
            <p class="text-muted mb-2">
              å¯¾æˆ¦ä¸­ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’è¨­å®šã—ã¾ã™ã€‚
            </p>
            <p class="small text-muted mb-3">
              ç¾åœ¨ã®åå‰ï¼š
              <strong>
                {{ user.display_name or 'æœªè¨­å®šï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰' }}
              </strong>
            </p>
            <a href="/name" class="btn btn-outline-secondary">åå‰ã‚’æ±ºã‚ã‚‹ / å¤‰æ›´ã™ã‚‹</a>
          </div>
        </div>
      </div>
    </div>
    <!-- å¿…è¦ãªã‚‰å°†æ¥ã“ã“ã«ãŠçŸ¥ã‚‰ã›ã‚„ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãªã© -->
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function () {
      const audio = document.getElementById("bgmAudio");
      const btn   = document.getElementById("bgmToggleBtn");
      if (!audio || !btn) return;

      const STORAGE_KEY = "ifp_bgm_enabled";

      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å‰å›ã®è¨­å®šã‚’å¾©å…ƒ
      let enabled = localStorage.getItem(STORAGE_KEY);
      enabled = (enabled === null) ? true : (enabled === "true");

      const updateButtonText = () => {
        btn.textContent = enabled ? "ğŸµ BGM ON" : "ğŸ”‡ BGM OFF";
      };

      const playIfAllowed = async () => {
        if (!enabled) {
          try { audio.pause(); } catch(e) {}
          return;
        }
        try {
          await audio.play();
        } catch (e) {
          // è‡ªå‹•å†ç”Ÿãƒ–ãƒ­ãƒƒã‚¯ã«å¼•ã£ã‹ã‹ã£ãŸå ´åˆã¯ãƒœã‚¿ãƒ³ã§å†ãƒãƒ£ãƒ¬ãƒ³ã‚¸
          console.log("BGM autoplay blocked:", e);
        }
      };

      // åˆæœŸçŠ¶æ…‹ã®ãƒœã‚¿ãƒ³è¡¨ç¤º
      updateButtonText();

      // åˆå›ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã“ã‹ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å†ç”Ÿã‚’è©¦ã¿ã‚‹
      const onFirstInteract = () => {
        document.removeEventListener("click", onFirstInteract);
        playIfAllowed();
      };
      document.addEventListener("click", onFirstInteract);

      // ãƒœã‚¿ãƒ³ã§ ON/OFF
      btn.addEventListener("click", async () => {
        enabled = !enabled;
        localStorage.setItem(STORAGE_KEY, String(enabled));
        updateButtonText();
        if (enabled) {
          await playIfAllowed();
        } else {
          audio.pause();
        }
      });
    })();
  </script>  
</body>
</html>
