<!-- templates/home.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ›ãƒ¼ãƒ  | Ishikawa Facilities & Parks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --bg: #f3f4ff;
      --panel-bg: #ffffff;
      --line-color: #4f46e5;
      --card-radius: 1rem;
      --shadow-soft: 0 14px 30px rgba(15,23,42,0.10);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #f5f3ff 30%, #f9fafb 70%);
      min-height: 100vh;
      color: #0f172a;
    }

    .navbar {
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,0.96) !important;
      border-bottom: 1px solid rgba(148,163,184,0.45);
    }

    .brand-mark {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      font-weight: 800;
      letter-spacing: .02em;
    }
    .brand-logo {
      width: 26px;
      height: 26px;
      border-radius: 8px;
      background: conic-gradient(from 160deg, #22c55e, #0ea5e9, #6366f1, #22c55e);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: .85rem;
      color: #fff;
      box-shadow: 0 0 0 2px #e5e7eb;
    }

    /* ===== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå…¨ä½“ ===== */
    .home-root {
      padding-top: 1.5rem;
      padding-bottom: 2.5rem;
    }

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 1.2rem;
    }

    @media (min-width: 992px) {
      .layout-main {
        grid-template-columns: minmax(0, 0.75fr) minmax(0, 1.25fr);
        align-items: stretch;
      }
    }

    /* ===== å·¦ã‚µã‚¤ãƒ‰ï¼šãƒãƒƒãƒ—ï¼†ã‚³ãƒ”ãƒ¼ ===== */
    .panel-left {
      background: rgba(255,255,255,0.97);
      border-radius: 1.4rem;
      padding: 1.5rem 1.3rem 1.6rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148,163,184,0.35);
      position: relative;
      overflow: hidden;
    }
    @media (min-width: 992px) {
      .panel-left {
        padding: 1.9rem 1.7rem 1.9rem;
      }
    }

    .tagline {
      font-size: .78rem;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: #6366f1;
      font-weight: 700;
      margin-bottom: .4rem;
    }
    .hero-title {
      font-size: clamp(1.4rem, 2vw + 1rem, 2.1rem);
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: .5rem;
    }
    .hero-title span.highlight {
      background: linear-gradient(110deg,#6366f1,#ec4899);
      -webkit-background-clip: text;
      color: transparent;
    }
    .hero-sub {
      font-size: .92rem;
      color: #4b5563;
      max-width: 22rem;
      margin-bottom: 1rem;
    }

    .hero-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: .4rem;
      margin-bottom: 1rem;
      font-size: .78rem;
    }
    .hero-chip {
      border-radius: 999px;
      padding: .3rem .75rem;
      background: #eef2ff;
      color: #4f46e5;
      display: inline-flex;
      align-items: center;
      gap: .35rem;
    }
    .hero-chip span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #4f46e5;
    }

    /* ãƒŸãƒ‹ãƒãƒƒãƒ—é¢¨ã‚¨ãƒªã‚¢ */
    .mini-map {
      margin-top: .4rem;
      position: relative;
      border-radius: 1.2rem;
      background: radial-gradient(circle at 10% 0%, #bfdbfe 0, #e0f2fe 30%, #fefce8 60%, #fee2e2 95%);
      height: 180px;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .mini-map { height: 210px; }
    }
    .mini-map-label {
      position: absolute;
      top: .65rem;
      left: .85rem;
      padding: .25rem .7rem;
      border-radius: 999px;
      font-size: .7rem;
      background: rgba(15,23,42,0.75);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: .3rem;
    }

    .map-shape {
      width: 140px;
      height: 140px;
      border-radius: 999px;
      border: 6px solid rgba(37,99,235,0.75);
      position: absolute;
      left: 50%;
      top: 55%;
      transform: translate(-50%, -50%) rotate(-18deg);
      box-shadow: 0 18px 45px rgba(30,64,175,0.5);
      background:
        radial-gradient(circle at 20% 10%, rgba(56,189,248,0.4) 0, transparent 55%),
        radial-gradient(circle at 70% 90%, rgba(96,165,250,0.55) 0, transparent 50%),
        radial-gradient(circle at 30% 75%, rgba(254,243,199,0.8) 0, transparent 55%);
    }

    .map-dot {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 5px rgba(34,197,94,0.3);
    }
    .map-dot::after {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: inherit;
      background: #f9fafb;
    }
    .map-dot.kzt   { left: 47%; top: 30%; }
    .map-dot.nnji  { left: 45%; top: 46%; }
    .map-dot.komat { left: 52%; top: 62%; }

    .legend {
      position: absolute;
      bottom: .6rem;
      right: .8rem;
      background: rgba(255,255,255,0.92);
      border-radius: .9rem;
      padding: .4rem .7rem;
      font-size: .72rem;
      color: #4b5563;
      display: flex;
      flex-direction: column;
      gap: .15rem;
      border: 1px solid rgba(148,163,184,0.4);
    }
    .legend-row {
      display: flex;
      align-items: center;
      gap: .35rem;
    }
    .legend-tag {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      background: #22c55e;
    }
    .legend-tag2 {
      background: #eab308;
    }

    /* ===== å³ã‚µã‚¤ãƒ‰ï¼šè·¯ç·šå›³ã‚«ãƒ¼ãƒ‰ ===== */
    .panel-right {
      background: transparent;
    }

    .section-title {
      font-size: .8rem;
      font-weight: 700;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: #6b7280;
      margin-bottom: .5rem;
    }

    .line-wrapper {
      position: relative;
      padding-left: 1.7rem;
      margin-left: .3rem;
    }
    .line-core {
      position: absolute;
      top: 0;
      bottom: 0;
      left: .55rem;
      width: 3px;
      border-radius: 999px;
      background: linear-gradient(to bottom, #4f46e5, #22c55e);
      opacity: .9;
    }

    .station-card {
      position: relative;
      background: var(--panel-bg);
      border-radius: var(--card-radius);
      padding: .9rem .9rem .95rem .9rem;
      margin-bottom: .75rem;
      box-shadow: 0 8px 22px rgba(15,23,42,0.08);
      border: 1px solid rgba(148,163,184,0.4);
      transition: transform .1s ease, box-shadow .1s ease, border-color .1s ease;
    }
    .station-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 16px 34px rgba(15,23,42,0.18);
      border-color: #6366f1;
    }

    .station-node {
      position: absolute;
      left: -1.35rem;
      top: 1.1rem;
      width: 15px;
      height: 15px;
      border-radius: 999px;
      background: #f9fafb;
      border: 3px solid #4f46e5;
      box-shadow: 0 0 0 4px rgba(191,219,254,0.9);
    }

    .station-header {
      display: flex;
      align-items: center;
      gap: .65rem;
      margin-bottom: .25rem;
    }

    .station-sign {
      min-width: 56px;
      padding: .15rem .45rem;
      border-radius: 999px;
      font-size: .7rem;
      font-weight: 700;
      text-align: center;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #111827;
      background: #e5e7eb;
    }
    .station-title {
      font-size: .95rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: .35rem;
    }
    .station-icon {
      font-size: 1.3rem;
    }

    .station-body {
      font-size: .82rem;
      color: #6b7280;
      margin-bottom: .45rem;
    }

    .station-actions {
      display: flex;
      flex-wrap: wrap;
      gap: .4rem;
      align-items: center;
      justify-content: flex-start;
    }

    .pill-btn {
      border-radius: 999px !important;
      padding-inline: 1.1rem;
      font-size: .78rem;
      padding-block: .2rem .25rem;
    }

    .station-note {
      font-size: .75rem;
      color: #9ca3af;
    }

    /* ã‚«ãƒ©ãƒ¼å·®åˆ¥åŒ– */
    .station-random .station-sign { background:#dbeafe; color:#1e40af; }
    .station-friend .station-sign { background:#dcfce7; color:#166534; }
    .station-challenge .station-sign { background:#fef3c7; color:#92400e; }
    .station-map .station-sign { background:#fce7f3; color:#9d174d; }
    .station-char .station-sign { background:#ede9fe; color:#5b21b6; }
    .station-name .station-sign { background:#e5e7eb; color:#111827; }
    .station-analytics .station-sign { background:#f1f5f9; color:#0f172a; }
    .station-admin .station-sign { background:#fee2e2; color:#b91c1c; }

    .badge-small {
      font-size: .7rem;
      padding: .2rem .45rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #2563eb;
      border: 1px solid rgba(129,140,248,0.4);
    }

    /* BGM ãƒœã‚¿ãƒ³ */
    #bgmToggleBtn {
      border-radius: 999px;
      box-shadow: 0 10px 25px rgba(15,23,42,0.25);
      background: #111827;
      color: #e5e7eb;
      border: 0;
      font-size: .8rem;
      padding-inline: .9rem;
    }
    #bgmToggleBtn:hover { background: #020617; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand brand-mark" href="/home">
        <span class="brand-logo">IF</span>
        <span>Ishikawa Facilities &amp; Parks</span>
      </a>
      <div class="ms-auto d-flex align-items-center gap-3">
        <span class="text-muted small d-none d-md-inline">
          ã‚ˆã†ã“ãã€<strong>{{ user.display_name or user.email }}</strong>
        </span>
        <a class="btn btn-outline-secondary btn-sm" href="/auth/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
      </div>
    </div>
  </nav>

  <!-- BGM -->
  <audio id="bgmAudio" loop>
    <source src="/static/bgm/home_bgm.mp3" type="audio/mpeg">
  </audio>
  <div style="position: fixed; right: 1rem; bottom: 1rem; z-index: 2000;">
    <button id="bgmToggleBtn" class="btn btn-sm">
      ğŸµ BGM ON
    </button>
  </div>

  <main class="container home-root">
    <div class="layout-main">
      <!-- å·¦ã‚«ãƒ©ãƒ ï¼šã‚³ãƒ”ãƒ¼ï¼‹ãƒŸãƒ‹ãƒãƒƒãƒ— -->
      <section class="panel-left">
        <div class="tagline">CONNECT Â· QUIZ Â· TOWN</div>
        <h1 class="hero-title">
          <span class="highlight">ã‚¯ã‚¤ã‚ºã§ç”ºã‚’ã¤ãªã</span><br>
          çŸ³å·ã®å…¬å…±æ–½è¨­ï¼†å…¬åœ’ã‚²ãƒ¼ãƒ 
        </h1>
        <p class="hero-sub">
          æ—©æŠ¼ã—ã‚¯ã‚¤ã‚ºã§å­¦ã³ãªãŒã‚‰ã€  
          å®Ÿéš›ã«è¶³ã‚’é‹ã‚“ã§ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã‚‹ã€‚  
          ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã¨ã¾ã¡æ­©ããŒãƒªãƒ³ã‚¯ã™ã‚‹ã€ŒçŸ³å·ç‰ˆã‚¯ã‚¤ã‚ºãƒ©ãƒœã€ã§ã™ã€‚
        </p>
        <div class="hero-chip-row">
          <div class="hero-chip">
            <span class="dot"></span><span>4äººå¯¾æˆ¦ã®æ—©æŠ¼ã—ãƒ¢ãƒ¼ãƒ‰</span>
          </div>
          <div class="hero-chip">
            <span class="dot" style="background:#22c55e;"></span><span>ãƒãƒƒãƒ—ã§ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³</span>
          </div>
          <div class="hero-chip">
            <span class="dot" style="background:#f97316;"></span><span>èªçŸ¥ç‡ãƒ‡ãƒ¼ã‚¿ã§ã¾ã¡ã‚’å¯è¦–åŒ–</span>
          </div>
        </div>

        <div class="mini-map">
          <div class="mini-map-label">
            <span>ğŸ—ºï¸ çŸ³å·çœŒã®ã€ŒçŸ¥ã£ã¦ã„ã‚‹å ´æ‰€ã€ã‚’å¢—ã‚„ãã†</span>
          </div>
          <div class="map-shape"></div>
          <div class="map-dot kzt" title="é‡‘æ²¢å¸‚"></div>
          <div class="map-dot nnji" title="é‡ã€…å¸‚å¸‚"></div>
          <div class="map-dot komat" title="å°æ¾å¸‚"></div>

          <div class="legend">
            <div class="legend-row">
              <span class="legend-tag"></span><span>ã‚¯ã‚¤ã‚ºã«ç™»å ´ã™ã‚‹æ–½è¨­</span>
            </div>
            <div class="legend-row">
              <span class="legend-tag2"></span><span>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚¹ãƒãƒƒãƒˆ</span>
            </div>
          </div>
        </div>
      </section>

      <!-- å³ã‚«ãƒ©ãƒ ï¼šè·¯ç·šå›³é¢¨ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ -->
      <section class="panel-right">
        <h2 class="section-title">PLAY LINE</h2>
        <div class="line-wrapper mb-4">
          <div class="line-core"></div>

          <!-- ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ -->
          <article class="station-card station-random">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">RANDOM</div>
              <div class="station-title">
                <span class="station-icon">ğŸ®</span> ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ
              </div>
            </div>
            <p class="station-body">
              ãã®ã¨ããƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°ã€‚  
              ã ã‚Œã¨ä¸€ç·’ã«çŸ³å·ã‚¯ã‚¤ã‚ºã‚’æˆ¦ã†ã‹ã¯å…¥ã£ã¦ã‹ã‚‰ã®ãŠæ¥½ã—ã¿ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/random" class="btn btn-primary pill-btn btn-sm">
                å¯¾æˆ¦ã‚’ã¯ã˜ã‚ã‚‹
              </a>
              <span class="station-note">æœ€å¤§4äººã§åŒæ™‚ãƒ—ãƒ¬ã‚¤</span>
            </div>
          </article>

          <!-- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ -->
          <article class="station-card station-friend">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">FRIEND</div>
              <div class="station-title">
                <span class="station-icon">ğŸ‘¥</span> ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ
              </div>
            </div>
            <p class="station-body">
              ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã€å‹ã ã¡ã‚„ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆã¨åŒã˜éƒ¨å±‹ã¸ã€‚  
              æ•™å®¤ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã©ã¡ã‚‰ã§ã‚‚ãƒ¯ã‚¤ãƒ¯ã‚¤éŠã¹ã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/room/new" class="btn btn-success pill-btn btn-sm">
                éƒ¨å±‹ã‚’ä½œæˆ
              </a>
              <a href="/quiz/room/join" class="btn btn-outline-success pill-btn btn-sm">
                éƒ¨å±‹ã«å‚åŠ 
              </a>
            </div>
          </article>

          <!-- ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ -->
          <article class="station-card station-challenge">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">CPU</div>
              <div class="station-title">
                <span class="station-icon">ğŸ”¥</span> ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰
              </div>
            </div>
            <p class="station-body">
              ã€Œã‚¸ãƒ£ãƒƒã‚¯ã€ã€Œã‚¯ã‚¤ãƒ¼ãƒ³ã€ã€Œã‚­ãƒ³ã‚°ã€ã‹ã‚‰é›£æ˜“åº¦ã‚’é¸æŠã€‚  
              ãã‚Œãã‚Œæ€§æ ¼ã®é•ã†CPUã¨ 1 vs 1 ã®æ—©æŠ¼ã—ãƒãƒˆãƒ«ãŒã§ãã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/challenge" class="btn btn-warning pill-btn btn-sm">
                é›£æ˜“åº¦ã‚’ãˆã‚‰ã¶
              </a>
              <span class="station-note">
                Jack ã¯ã‚„ã•ã—ã‚ã€King ã¯ã‹ãªã‚Šæ‰‹ã”ã‚ã„è¨­å®šã§ã™ã€‚
              </span>
            </div>
          </article>

          <!-- ãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ— -->
          <article class="station-card station-map">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">MAP</div>
              <div class="station-title">
                <span class="station-icon">ğŸ“</span> ãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆ
              </div>
            </div>
            <p class="station-body">
              å®Ÿéš›ã«å…¬åœ’ã‚„å…¬å…±æ–½è¨­ã¸è¡Œã£ã¦ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã€‚  
              è¨ªã‚ŒãŸå ´æ‰€ã«å¿œã˜ã¦ã‚¹ã‚¿ãƒ³ãƒ—ãŒè§£æ”¾ã•ã‚Œã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒå¢—ãˆã¦ã„ãã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/map" class="btn btn-outline-primary pill-btn btn-sm">
                ãƒãƒƒãƒ—ã‚’é–‹ã
              </a>
              <span class="station-note">ä½ç½®æƒ…å ± ON æ¨å¥¨</span>
            </div>
          </article>
        </div>

        <h2 class="section-title">COLLECTION &amp; PROFILE</h2>
        <div class="line-wrapper mb-4">
          <div class="line-core"></div>

          <!-- æ‰€æŒã‚¹ã‚¿ãƒ³ãƒ— -->
          <article class="station-card station-char">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">STAMP</div>
              <div class="station-title">
                <span class="station-icon">ğŸ¦«</span> æ‰€æŒã‚¹ã‚¿ãƒ³ãƒ—
              </div>
            </div>
            <p class="station-body">
              ã“ã‚Œã¾ã§æ‰‹ã«å…¥ã‚ŒãŸã‚¹ã‚¿ãƒ³ãƒ—ã®ä¸€è¦§ã‚’ç¢ºèªã€‚  
              ã©ã®å¸‚ç”ºãƒ»æ–½è¨­ã§ã‚²ãƒƒãƒˆã—ãŸã‹ã‚’æŒ¯ã‚Šè¿”ã‚‹æ¥½ã—ã¿ã‚‚ã€‚
            </p>
            <div class="station-actions">
              <a href="/chars" class="btn btn-outline-primary pill-btn btn-sm">
                ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã‚‹
              </a>
            </div>
          </article>

          <!-- ä½œå•ãƒšãƒ¼ã‚¸ -->
          <article class="station-card station-char">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">MAKE</div>
              <div class="station-title">
                <span class="station-icon">âœï¸</span> ä½œå•
              </div>
            </div>
            <p class="station-body">
              ã‚ãªãŸã®ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆã‚„ãƒ­ãƒ¼ã‚«ãƒ«çŸ¥è­˜ã‚’ã€ã‚¯ã‚¤ã‚ºã®1å•ã¨ã—ã¦ç™»éŒ²ã€‚  
              ã¿ã‚“ãªã§ã€ŒçŸ³å·ã‚¯ã‚¤ã‚ºå›³é‘‘ã€ã‚’è‚²ã¦ã¦ã„ããƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/maker" class="btn btn-outline-dark pill-btn btn-sm">
                ä½œå•ãƒšãƒ¼ã‚¸ã¸
              </a>
            </div>
          </article>

          <!-- åå‰ã®æ±ºå®šãƒ»å¤‰æ›´ -->
          <article class="station-card station-name">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">NAME</div>
              <div class="station-title">
                <span class="station-icon">ğŸ·ï¸</span> åå‰ã®æ±ºå®šãƒ»å¤‰æ›´
              </div>
            </div>
            <p class="station-body mb-1">
              å¯¾æˆ¦ä¸­ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’è¨­å®šãƒ»å¤‰æ›´ã§ãã¾ã™ã€‚
            </p>
            <p class="station-body" style="font-size:.78rem; color:#9ca3af;">
              ç¾åœ¨ã®åå‰ï¼š
              <strong>{{ user.display_name or 'æœªè¨­å®šï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰' }}</strong>
            </p>
            <div class="station-actions">
              <a href="/name" class="btn btn-outline-secondary pill-btn btn-sm">
                åå‰ã‚’æ±ºã‚ã‚‹ / å¤‰æ›´ã™ã‚‹
              </a>
            </div>
          </article>
        </div>

        {% if user.role in ["admin", "researcher"] %}
        <h2 class="section-title">ANALYTICS LINE</h2>
        <div class="line-wrapper">
          <div class="line-core"></div>

          <!-- èªçŸ¥ç‡ãƒ‡ãƒ¼ã‚¿ -->
          <article class="station-card station-analytics">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">DATA</div>
              <div class="station-title">
                <span class="station-icon">ğŸ“Š</span> ãƒ‡ãƒ¼ã‚¿æä¾›ï¼ˆèªçŸ¥ç‡ï¼‰
              </div>
            </div>
            <p class="station-body">
              ã‚¯ã‚¤ã‚ºã®æ­£è§£ï¼ä¸æ­£è§£ã‹ã‚‰ã€æ–½è¨­åˆ¥ãƒ»å¸‚ç”ºåˆ¥ã®ã€ŒèªçŸ¥ç‡ã€ã‚’é›†è¨ˆã€‚  
              ä»®æƒ³ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¯ãƒ¼ã‚¯ã®çµæœã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚„CSVã§ç¢ºèªã§ãã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/recognition" class="btn btn-outline-primary pill-btn btn-sm">
                èªçŸ¥ç‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
              </a>
              <a href="/api/recognition/export.csv" class="btn btn-outline-secondary pill-btn btn-sm">
                CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
              </a>
            </div>
          </article>

          <!-- ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ -->
          <article class="station-card station-analytics">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">DATA</div>
              <div class="station-title">
                <span class="station-icon">ğŸ—‚ï¸</span> ãƒ‡ãƒ¼ã‚¿æä¾›ãã®ï¼’ï¼ˆãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ï¼‰
              </div>
            </div>
            <p class="station-body">
              æ–½è¨­ã”ã¨ã®ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ•°ã‚’æœŸé–“åˆ¥ã«é›†è¨ˆã—ã€  
              åˆ©ç”¨å®Ÿæ…‹ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã®ç°¡æ˜“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨CSVã‚’æä¾›ã—ã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/api/checkins/summary" class="btn btn-outline-primary pill-btn btn-sm">
                ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
              </a>
              <a href="/api/export/checkins_summary.csv" class="btn btn-outline-secondary pill-btn btn-sm">
                CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
              </a>
            </div>
          </article>

          {% if user.role in ["admin"] %}
          <!-- ä½œå•ç·¨é›†ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ -->
          <article class="station-card station-admin">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">ADMIN</div>
              <div class="station-title">
                <span class="station-icon">ğŸ› ï¸</span> ä½œå•ç·¨é›†
              </div>
            </div>
            <p class="station-body">
              ã¿ã‚“ãªãŒç™»éŒ²ã—ãŸã‚ªãƒªã‚¸ãƒŠãƒ«å•é¡Œã‚’ä¸€è¦§ã—ã€ä¸é©åˆ‡ãªå•é¡Œã‚’å‰Šé™¤ã§ãã¾ã™ã€‚  
              æˆæ¥­ã‚„ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚ã‚ã›ã¦ã€å•é¡Œãƒ—ãƒ¼ãƒ«ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã™ã‚‹ç®¡ç†ç”¨ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/maker/admin" class="btn btn-outline-danger pill-btn btn-sm">
                ä½œå•ç·¨é›†ãƒšãƒ¼ã‚¸ã¸
              </a>
              <span class="station-note">â€» ç®¡ç†è€…å°‚ç”¨æ©Ÿèƒ½</span>
            </div>
          </article>
          {% endif %}
        </div>
        {% endif %}
      </section>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- BGMåˆ¶å¾¡ -->
  <script>
    (function () {
      const audio = document.getElementById("bgmAudio");
      const btn   = document.getElementById("bgmToggleBtn");
      if (!audio || !btn) return;

      const STORAGE_KEY = "ifp_bgm_enabled";

      let enabled = localStorage.getItem(STORAGE_KEY);
      enabled = (enabled === null) ? true : (enabled === "true");

      const updateButtonText = () => {
        btn.textContent = enabled ? "ğŸµ BGM ON" : "ğŸ”‡ BGM OFF";
      };

      const playIfAllowed = async () => {
        if (!enabled) {
          try { audio.pause(); } catch(e) {}
          return;
        }
        try {
          await audio.play();
        } catch (e) {
          console.log("BGM autoplay blocked:", e);
        }
      };

      updateButtonText();

      const onFirstInteract = () => {
        document.removeEventListener("click", onFirstInteract);
        playIfAllowed();
      };
      document.addEventListener("click", onFirstInteract);

      btn.addEventListener("click", async () => {
        enabled = !enabled;
        localStorage.setItem(STORAGE_KEY, String(enabled));
        updateButtonText();
        if (enabled) {
          await playIfAllowed();
        } else {
          audio.pause();
        }
      });
    })();
  </script>
</body>
</html>
