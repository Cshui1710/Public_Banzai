<!-- templates/home.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ›ãƒ¼ãƒ  | Ishikawa Facilities & Parks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --bg: #f3f4ff;
      --panel-bg: #ffffff;
      --line-color: #4f46e5;
      --card-radius: 1rem;
      --shadow-soft: 0 14px 30px rgba(15,23,42,0.10);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #f5f3ff 30%, #f9fafb 70%);
      min-height: 100vh;
      color: #0f172a;
    }

    .navbar {
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,0.96) !important;
      border-bottom: 1px solid rgba(148,163,184,0.45);
    }

    .brand-mark {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      font-weight: 800;
      letter-spacing: .02em;
    }
    .brand-logo {
      width: 26px;
      height: 26px;
      border-radius: 8px;
      background: conic-gradient(from 160deg, #22c55e, #0ea5e9, #6366f1, #22c55e);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: .85rem;
      color: #fff;
      box-shadow: 0 0 0 2px #e5e7eb;
    }

    /* ãƒŠãƒ“å³å´ã®ãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆã‚¹ãƒãƒ›ã§æŠ˜ã‚Šè¿”ã—åˆ¶å¾¡ï¼‰ */
    .nav-right {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: .5rem;
      flex-wrap: wrap;
    }

    /* ===== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå…¨ä½“ ===== */
    .home-root {
      padding-top: 1.5rem;
      padding-bottom: 2.5rem;
    }

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 1.2rem;
    }

    @media (min-width: 992px) {
      .layout-main {
        grid-template-columns: minmax(0, 0.75fr) minmax(0, 1.25fr);
        align-items: stretch;
      }
    }

    /* ===== å·¦ã‚µã‚¤ãƒ‰ï¼šãƒãƒƒãƒ—ï¼†ã‚³ãƒ”ãƒ¼ ===== */
    .panel-left {
      background: rgba(255,255,255,0.97);
      border-radius: 1.4rem;
      padding: 1.5rem 1.3rem 1.9rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148,163,184,0.35);
      position: relative;
      overflow: hidden;
    }
    @media (min-width: 992px) {
      .panel-left {
        padding: 1.9rem 1.7rem 2.1rem;
      }
    }

    .tagline {
      font-size: .78rem;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: #6366f1;
      font-weight: 700;
      margin-bottom: .4rem;
    }
    .hero-title {
      font-size: clamp(1.4rem, 2vw + 1rem, 2.1rem);
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: .5rem;
    }
    .hero-title span.highlight {
      background: linear-gradient(110deg,#6366f1,#ec4899);
      -webkit-background-clip: text;
      color: transparent;
    }
    .hero-sub {
      font-size: .92rem;
      color: #4b5563;
      max-width: 22rem;
      margin-bottom: 1rem;
    }

    .hero-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: .4rem;
      margin-bottom: 1rem;
      font-size: .78rem;
    }
    .hero-chip {
      border-radius: 999px;
      padding: .3rem .75rem;
      background: #eef2ff;
      color: #4f46e5;
      display: inline-flex;
      align-items: center;
      gap: .35rem;
    }
    .hero-chip span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #4f46e5;
    }

    /* ãƒŸãƒ‹ãƒãƒƒãƒ—é¢¨ã‚¨ãƒªã‚¢ */
    .mini-map {
      margin-top: .4rem;
      position: relative;
      border-radius: 1.2rem;
      background: radial-gradient(circle at 10% 0%, #bfdbfe 0, #e0f2fe 30%, #fefce8 60%, #fee2e2 95%);
      height: 180px;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .mini-map { height: 210px; }
    }
    .mini-map-label {
      position: absolute;
      top: .65rem;
      left: .85rem;
      padding: .25rem .7rem;
      border-radius: 999px;
      font-size: .7rem;
      background: rgba(15,23,42,0.75);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: .3rem;
    }

    .map-shape {
      width: 140px;
      height: 140px;
      border-radius: 999px;
      border: 6px solid rgba(37,99,235,0.75);
      position: absolute;
      left: 50%;
      top: 55%;
      transform: translate(-50%, -50%) rotate(-18deg);
      box-shadow: 0 18px 45px rgba(30,64,175,0.5);
      background:
        radial-gradient(circle at 20% 10%, rgba(56,189,248,0.4) 0, transparent 55%),
        radial-gradient(circle at 70% 90%, rgba(96,165,250,0.55) 0, transparent 50%),
        radial-gradient(circle at 30% 75%, rgba(254,243,199,0.8) 0, transparent 55%);
    }

    .map-dot {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 5px rgba(34,197,94,0.3);
    }
    .map-dot::after {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: inherit;
      background: #f9fafb;
    }
    .map-dot.kzt   { left: 47%; top: 30%; }
    .map-dot.nnji  { left: 45%; top: 46%; }
    .map-dot.komat { left: 52%; top: 62%; }

    .legend {
      position: absolute;
      bottom: .6rem;
      right: .8rem;
      background: rgba(255,255,255,0.92);
      border-radius: .9rem;
      padding: .4rem .7rem;
      font-size: .72rem;
      color: #4b5563;
      display: flex;
      flex-direction: column;
      gap: .15rem;
      border: 1px solid rgba(148,163,184,0.4);
    }
    .legend-row {
      display: flex;
      align-items: center;
      gap: .35rem;
    }
    .legend-tag {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      background: #22c55e;
    }
    .legend-tag2 {
      background: #eab308;
    }

    /* ===== å³ã‚µã‚¤ãƒ‰ï¼šè·¯ç·šå›³ã‚«ãƒ¼ãƒ‰ ===== */
    .panel-right {
      background: transparent;
    }

    .section-title {
      font-size: .8rem;
      font-weight: 700;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: #6b7280;
      margin-bottom: .5rem;
    }

    .line-wrapper {
      position: relative;
      padding-left: 1.7rem;
      margin-left: .3rem;
    }
    .line-core {
      position: absolute;
      top: 0;
      bottom: 0;
      left: .55rem;
      width: 3px;
      border-radius: 999px;
      background: linear-gradient(to bottom, #4f46e5, #22c55e);
      opacity: .9;
    }

    .station-card {
      position: relative;
      background: var(--panel-bg);
      border-radius: var(--card-radius);
      padding: .9rem .9rem .95rem .9rem;
      margin-bottom: .75rem;
      box-shadow: 0 8px 22px rgba(15,23,42,0.08);
      border: 1px solid rgba(148,163,184,0.4);
      transition: transform .1s ease, box-shadow .1s ease, border-color .1s ease;
    }
    .station-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 16px 34px rgba(15,23,42,0.18);
      border-color: #6366f1;
    }

    .station-node {
      position: absolute;
      left: -1.35rem;
      top: 1.1rem;
      width: 15px;
      height: 15px;
      border-radius: 999px;
      background: #f9fafb;
      border: 3px solid #4f46e5;
      box-shadow: 0 0 0 4px rgba(191,219,254,0.9);
    }

    .station-header {
      display: flex;
      align-items: center;
      gap: .65rem;
      margin-bottom: .25rem;
    }

    .station-sign {
      min-width: 56px;
      padding: .15rem .45rem;
      border-radius: 999px;
      font-size: .7rem;
      font-weight: 700;
      text-align: center;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #111827;
      background: #e5e7eb;
    }
    .station-title {
      font-size: .95rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: .35rem;
    }
    .station-icon {
      font-size: 1.3rem;
    }

    .station-body {
      font-size: .82rem;
      color: #6b7280;
      margin-bottom: .45rem;
    }

    .station-actions {
      display: flex;
      flex-wrap: wrap;
      gap: .4rem;
      align-items: center;
      justify-content: flex-start;
    }

    .pill-btn {
      border-radius: 999px !important;
      padding-inline: 1.1rem;
      font-size: .78rem;
      padding-block: .2rem .25rem;
    }

    .station-note {
      font-size: .75rem;
      color: #9ca3af;
    }

    /* ã‚«ãƒ©ãƒ¼å·®åˆ¥åŒ– */
    .station-random .station-sign { background:#dbeafe; color:#1e40af; }
    .station-friend .station-sign { background:#dcfce7; color:#166534; }
    .station-challenge .station-sign { background:#fef3c7; color:#92400e; }
    .station-map .station-sign { background:#fce7f3; color:#9d174d; }
    .station-char .station-sign { background:#ede9fe; color:#5b21b6; }
    .station-name .station-sign { background:#e5e7eb; color:#111827; }
    .station-analytics .station-sign { background:#f1f5f9; color:#0f172a; }
    .station-admin .station-sign { background:#fee2e2; color:#b91c1c; }

    .badge-small {
      font-size: .7rem;
      padding: .2rem .45rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #2563eb;
      border: 1px solid rgba(129,140,248,0.4);
    }

    /* BGM ãƒœã‚¿ãƒ³ */
    #bgmToggleBtn {
      border-radius: 999px;
      box-shadow: 0 10px 25px rgba(15,23,42,0.25);
      background: #111827;
      color: #e5e7eb;
      border: 0;
      font-size: .8rem;
      padding-inline: .9rem;
    }
    #bgmToggleBtn:hover { background: #020617; }

    /* ===== HOME ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
    .home-tutorial-backdrop {
      position: fixed;
      inset: 0;
      display: none;              /* JSã§è¡¨ç¤ºåˆ¶å¾¡ */
      align-items: center;
      justify-content: center;
      z-index: 3000;
      background: radial-gradient(circle at top, rgba(15,23,42,0.75) 0, rgba(15,23,42,0.85) 45%, rgba(15,23,42,0.9) 100%);
    }

    .home-tutorial-card {
      background: #ffffff;
      border-radius: 1.25rem;
      max-width: 720px;
      width: 92%;
      box-shadow: 0 24px 60px rgba(15,23,42,0.55);
      padding: 1.6rem 1.8rem 1.3rem;
      position: relative;
    }

    .home-tutorial-header {
      display: flex;
      align-items: center;
      gap: .6rem;
      margin-bottom: .4rem;
    }

    .home-tutorial-badge {
      font-size: .75rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #6366f1;
      font-weight: 700;
    }

    .home-tutorial-title {
      font-size: 1.3rem;
      font-weight: 800;
    }

    .home-tutorial-title span {
      background: linear-gradient(110deg,#6366f1,#f97316);
      -webkit-background-clip: text;
      color: transparent;
    }

    .home-tutorial-body {
      margin-top: .6rem;
      margin-bottom: .8rem;
    }

    .home-tutorial-page {
      display: none;
    }

    .home-tutorial-page.active {
      display: block;
    }

    .home-tutorial-list {
      padding-left: 1rem;
      margin-bottom: .4rem;
    }

    .home-tutorial-list li {
      margin-bottom: .25rem;
      font-size: .94rem;
    }

    .home-tutorial-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: .75rem;
      margin-top: .75rem;
    }

    .home-tutorial-steps {
      font-size: .8rem;
      color: #6b7280;
    }

    .home-tutorial-actions button {
      min-width: 90px;
    }

    /* ===== æ®¿å ‚å…¥ã‚Šã‚¨ãƒªã‚¢ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼åŒ–ãƒ»ç™½ãƒ™ãƒ¼ã‚¹ç‰ˆï¼‰ ===== */
    .hall-of-fame {
      margin-top: 1.1rem;
      margin-bottom: 1.2rem;
    }

    .hof-shell {
      position: relative;
      border-radius: 1.1rem;
      padding: 1.0rem 1.0rem 1.1rem;
      background:
        radial-gradient(circle at 0% 0%, rgba(251,191,36,0.18) 0, transparent 45%),
        radial-gradient(circle at 100% 0%, rgba(129,140,248,0.2) 0, transparent 45%),
        linear-gradient(135deg, #ffffff, #f9fafb);
      color: #111827;
      box-shadow: 0 14px 35px rgba(148,163,184,0.35);
      border: 1px solid rgba(148,163,184,0.55);
      overflow: hidden;
      min-height: 210px;
    }

    .hof-shell::before {
      content: "";
      position: absolute;
      inset: -40%;
      opacity: 0.16;
      background:
        radial-gradient(circle at 20% 15%, rgba(253,224,71,0.8), transparent 55%),
        radial-gradient(circle at 85% 0%, rgba(129,140,248,0.9), transparent 55%);
      pointer-events: none;
    }

    .hof-inner {
      position: relative;
      z-index: 1;
    }

    .hof-header {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: .75rem;
      margin-bottom: .55rem;
    }

    .hof-header-left {
      display: flex;
      align-items: center;
      gap: .55rem;
    }

    .hof-medal {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 0%, #facc15, #f97316);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 3px rgba(250,204,21,0.6);
      font-size: 1.2rem;
    }

    .hof-header-text-main {
      font-size: .85rem;
      font-weight: 800;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #1f2937;
    }

    .hof-header-text-sub {
      font-size: .8rem;
      color: #6b7280;
    }

    .hof-carousel {
      margin-top: .5rem;
      overflow: hidden;
      border-radius: .85rem;
      border: 1px solid rgba(203,213,225,0.9);
      background:
        radial-gradient(circle at 0% 0%, rgba(239,246,255,0.9) 0, transparent 55%),
        linear-gradient(to bottom, #ffffff, #f9fafb);
      min-height: 170px;
    }

    .hof-track {
      display: flex;
      width: 200%;
      transition: transform .55s cubic-bezier(0.32, 0.72, 0, 1);
    }

    .hof-slide {
      min-width: 100%;
      padding: .7rem .9rem .65rem;
    }

    .hof-block {
      background: transparent;
      border-radius: .75rem;
      padding: .2rem 0 .1rem;
      border: none;
      box-shadow: none;
    }

    .hof-title {
      font-size: .8rem;
      font-weight: 700;
      color: #111827;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.2rem;
    }

    .hof-title span.badge-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      display: inline-block;
      background: linear-gradient(135deg, #f97316, #facc15);
      box-shadow: 0 0 0 2px rgba(253,224,71,0.8);
    }

    .hof-subtitle {
      font-size: .72rem;
      color: #6b7280;
      margin-bottom: .15rem;
    }

    .hof-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    .hof-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
      padding-block: 4px;
      font-size: .8rem;
      color: #374151;
    }

    .hof-name {
      font-weight: 600;
      color: #111827;
      display: inline-flex;
      align-items: center;
      gap: .4rem;
    }

    .hof-rank-pill {
      min-width: 20px;
      height: 20px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: .7rem;
      font-weight: 700;
      background: #ffffff;
      color: #111827;
      border: 1px solid rgba(148,163,184,0.8);
      box-shadow: 0 4px 10px rgba(148,163,184,0.45);
    }

    .hof-meta {
      font-size: 0.72rem;
      color: #6b7280;
    }

    .hof-empty {
      font-size: 0.74rem;
      color: #9ca3af;
    }

    .hof-indicators {
      display: flex;
      justify-content: center;
      gap: .4rem;
      margin-top: .45rem;
    }

    .hof-indicator {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.75);
      background: #ffffff;
      color: #111827;
      font-size: .72rem;
      padding: .18rem .7rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: .25rem;
      transition: background .15s ease, transform .1s ease, box-shadow .15s ease, border-color .15s ease;
      box-shadow: 0 4px 10px rgba(148,163,184,0.35);
    }

    .hof-indicator span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(148,163,184,0.75);
    }

    .hof-indicator.active {
      background: linear-gradient(135deg, #f97316, #facc15);
      color: #111827;
      border-color: rgba(250,204,21,0.95);
      box-shadow: 0 0 0 2px rgba(252,211,77,0.55);
      transform: translateY(-1px);
    }

    .hof-indicator.active span.dot {
      background: #b45309;
    }

    .hof-indicator:hover:not(.active) {
      transform: translateY(-1px);
      box-shadow: 0 0 0 2px rgba(148,163,184,0.5);
    }

    @media (max-width: 575.98px) {
      .hof-shell {
        padding-inline: .85rem;
      }
      .hof-header-text-main {
        font-size: .8rem;
      }
      .hof-header-text-sub {
        font-size: .78rem;
      }
    }

    /* ====== ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆä»¥ä¸‹ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ ====== */
    @media (max-width: 991.98px) {
      .home-root {
        padding-top: 1.2rem;
        padding-bottom: 2rem;
      }
    }

    /* ====== ã‚¹ãƒãƒ›å‘ã‘å¾®èª¿æ•´ï¼ˆï½768pxï¼‰ ====== */
    @media (max-width: 767.98px) {
      .navbar .container {
        padding-inline: 1rem;
      }

      .nav-right {
        width: 100%;
        justify-content: flex-start;
        margin-top: .35rem;
      }
      .nav-right .btn,
      .nav-right .btn-soft {
        font-size: .75rem;
        padding-inline: .7rem;
        padding-block: .25rem .3rem;
      }
      .nav-right span.small {
        font-size: .75rem;
      }

      .panel-left {
        border-radius: 1.1rem;
        padding: 1.3rem 1.1rem 1.6rem;
      }
      .hero-sub {
        max-width: 100%;
        font-size: .88rem;
      }

      .station-card {
        padding: .85rem .85rem .9rem;
      }
      .station-body {
        font-size: .8rem;
      }
    }

    /* ====== ã•ã‚‰ã«ç‹­ã„ã‚¹ãƒãƒ›å‘ã‘ï¼ˆï½576pxï¼‰ ====== */
    @media (max-width: 575.98px) {
      .home-root {
        padding-top: 1rem;
        padding-bottom: 1.8rem;
      }

      .brand-logo {
        width: 24px;
        height: 24px;
        font-size: .8rem;
      }
      .brand-mark span:last-child {
        font-size: .9rem;
      }

      .hero-title {
        font-size: 1.25rem;
      }

      .mini-map {
        height: 170px;
      }

      /* ã‚«ãƒ¼ãƒ‰å†…ãƒœã‚¿ãƒ³ã‚’ç¸¦ä¸¦ã³ï¼†åºƒã‚ã« */
      .station-actions {
        flex-direction: column;
        align-items: stretch;
      }
      .station-actions .btn {
        width: 100%;
        justify-content: center;
      }
      .station-note {
        text-align: left;
      }

      /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ãŒé‚ªé­”ã«ãªã‚Šã™ããªã„ã‚ˆã†å°‘ã—å†…å´ã« */
      .home-root + div[style*="position: fixed"] {
        right: .7rem !important;
        bottom: .7rem !important;
      }

      .home-tutorial-card {
        padding: 1.3rem 1.2rem 1.1rem;
        width: 94%;
      }
      .home-tutorial-title {
        font-size: 1.15rem;
      }
      .home-tutorial-list li {
        font-size: .88rem;
      }
    }
    
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand brand-mark" href="/home">
        <span class="brand-logo">IF</span>
        <span>Ishikawa Facilities &amp; Parks</span>
      </a>
      <div class="nav-right ms-auto d-flex align-items-center gap-2">
        <button id="homeHelpBtn" class="btn btn-outline-primary btn-sm btn-soft">
          â“ ã‚ãã³ã‹ãŸ
        </button>
        <span class="text-muted small d-none d-md-inline">
          ã‚ˆã†ã“ãã€<strong>{{ user.display_name or user.email }}</strong>
        </span>
        <a class="btn btn-outline-secondary btn-sm" href="/auth/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
      </div>
    </div>
  </nav>

  <!-- BGM -->
  <audio id="bgmAudio" loop>
    <source src="/static/bgm/home_bgm2.mp3" type="audio/mpeg">
  </audio>
  <!-- å³ä¸‹ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ï¼ˆã‚¢ãƒ—ãƒªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‹BGMï¼‰ -->
  <div style="position: fixed; right: 1rem; bottom: 1rem; z-index: 2000; display:flex; flex-direction:column; gap:0.5rem; align-items:flex-end;">
    <button id="appFeedbackBtn" class="btn btn-sm btn-outline-secondary">
      ğŸ’¬ ã“ã®ã‚¢ãƒ—ãƒªã¸ã®ã”æ„è¦‹
    </button>
    <button id="bgmToggleBtn" class="btn btn-sm btn-dark">
      ğŸµ BGM ON
    </button>
  </div>

  <main class="container home-root">
    <div class="layout-main">
      <!-- å·¦ã‚«ãƒ©ãƒ ï¼šã‚³ãƒ”ãƒ¼ï¼‹ãƒŸãƒ‹ãƒãƒƒãƒ— -->
      <section class="panel-left">
        <div class="tagline">CONNECT Â· QUIZ Â· TOWN</div>
        <h1 class="hero-title">
          <span class="highlight">ã‚¯ã‚¤ã‚ºã§ã¤ãªãçŸ³å·ã®ã¾ã¡</span><br>
        </h1>
        <p class="hero-sub">
          æ—©æŠ¼ã—ã‚¯ã‚¤ã‚ºã§å­¦ã³ãªãŒã‚‰ã€  
          å®Ÿéš›ã«è¶³ã‚’é‹ã‚“ã§ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã‚‹ã€‚  
          ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã¨ã¾ã¡æ­©ããŒãƒªãƒ³ã‚¯ã™ã‚‹ã€ŒçŸ³å·ç‰ˆã‚¯ã‚¤ã‚ºãƒ©ãƒœã€ã§ã™ã€‚
        </p>
        <div class="hero-chip-row">
          <div class="hero-chip">
            <span class="dot"></span><span>4äººå¯¾æˆ¦ã®æ—©æŠ¼ã—ãƒ¢ãƒ¼ãƒ‰</span>
          </div>
          <div class="hero-chip">
            <span class="dot" style="background:#22c55e;"></span><span>ãƒãƒƒãƒ—ã§ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³</span>
          </div>
          <div class="hero-chip">
            <span class="dot" style="background:#f97316;"></span><span>èªçŸ¥ç‡ãƒ‡ãƒ¼ã‚¿ã§ã¾ã¡ã‚’å¯è¦–åŒ–</span>
          </div>
        </div>

        <div class="mini-map">
          <div class="mini-map-label">
            <span>ğŸ—ºï¸ çŸ³å·çœŒã®ã€ŒçŸ¥ã£ã¦ã„ã‚‹å ´æ‰€ã€ã‚’å¢—ã‚„ãã†</span>
          </div>
          <div class="map-shape"></div>
          <div class="map-dot kzt" title="é‡‘æ²¢å¸‚"></div>
          <div class="map-dot nnji" title="é‡ã€…å¸‚å¸‚"></div>
          <div class="map-dot komat" title="å°æ¾å¸‚"></div>

          <div class="legend">
            <div class="legend-row">
              <span class="legend-tag"></span><span>ã‚¯ã‚¤ã‚ºã«ç™»å ´ã™ã‚‹æ–½è¨­</span>
            </div>
            <div class="legend-row">
              <span class="legend-tag2"></span><span>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚¹ãƒãƒƒãƒˆ</span>
            </div>
          </div>
        </div>

        <!-- æ®¿å ‚å…¥ã‚Šã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ -->
        <div class="hall-of-fame">
          <div class="hof-shell">
            <div class="hof-inner">
              <div class="hof-header">
                <div class="hof-header-left">
                  <div class="hof-medal">ğŸ‘‘</div>
                  <div>
                    <div class="hof-header-text-main">HALL OF FAME</div>
                    <div class="hof-header-text-sub">ã‚¯ã‚¤ã‚ºã¨ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŒã‚“ã°ã£ã¦ã„ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŸã¡</div>
                  </div>
                </div>
              </div>

              <div class="hof-carousel">
                <div class="hof-track" id="hofTrack">
                  <!-- ã‚¹ãƒ©ã‚¤ãƒ‰1ï¼šãŸãã•ã‚“éŠã‚“ã§ãã‚ŒãŸäºº -->
                  <div class="hof-slide" data-index="0">
                    <div class="hof-block">
                      <div class="hof-title">
                        <span class="badge-dot"></span>
                        <span>ğŸ† ãŸãã•ã‚“éŠã‚“ã§ãã‚ŒãŸäºº</span>
                      </div>
                      <div class="hof-subtitle">
                        ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒãƒ»ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒãƒ»ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã®åˆè¨ˆãƒ—ãƒ¬ã‚¤æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§ã™ã€‚
                      </div>
                      <ul id="hofTopPlayers" class="hof-list">
                        <li class="hof-empty">ã¾ã é›†è¨ˆä¸­ã§ã™â€¦ ã‚¯ã‚¤ã‚ºã«å‚åŠ ã—ã¦ã¿ã‚ˆã†ï¼</li>
                      </ul>
                    </div>
                  </div>

                  <!-- ã‚¹ãƒ©ã‚¤ãƒ‰2ï¼šã‚­ãƒ³ã‚°ã‚’å€’ã—ãŸäºº -->
                  <div class="hof-slide" data-index="1">
                    <div class="hof-block">
                      <div class="hof-title">
                        <span class="badge-dot"></span>
                        <span>ğŸ‘‘ ã‚­ãƒ³ã‚°ã‚’å€’ã—ãŸäºº</span>
                      </div>
                      <div class="hof-subtitle">
                        ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã®æœ€å¼·CPUã€Œã‚­ãƒ³ã‚°ã€ã‚’æ’ƒç ´ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸€è¦§ã§ã™ã€‚
                      </div>
                      <ul id="hofKingClear" class="hof-list">
                        <li class="hof-empty">ã¾ã ã‚­ãƒ³ã‚°ã‚’å€’ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã„ã¾ã›ã‚“ã€‚</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <div class="hof-indicators">
                <button class="hof-indicator active" data-index="0">
                  <span class="dot"></span><span>ãƒ—ãƒ¬ã‚¤æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°</span>
                </button>
                <button class="hof-indicator" data-index="1">
                  <span class="dot"></span><span>ã‚­ãƒ³ã‚°æ’ƒç ´ãƒ©ãƒ³ã‚­ãƒ³ã‚°</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- å³ã‚«ãƒ©ãƒ ï¼šè·¯ç·šå›³é¢¨ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ -->
      <section class="panel-right">
        <h2 class="section-title">PLAY LINE</h2>
        <div class="line-wrapper mb-4">
          <div class="line-core"></div>

          <!-- ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ -->
          <article class="station-card station-random">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">RANDOM</div>
              <div class="station-title">
                <span class="station-icon">ğŸ®</span> ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ
              </div>
            </div>
            <p class="station-body">
              ãã®ã¨ããƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°ã€‚  
              ã ã‚Œã¨ä¸€ç·’ã«çŸ³å·ã‚¯ã‚¤ã‚ºã‚’æˆ¦ã†ã‹ã¯å…¥ã£ã¦ã‹ã‚‰ã®ãŠæ¥½ã—ã¿ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/random" class="btn btn-primary pill-btn btn-sm">
                å¯¾æˆ¦ã‚’ã¯ã˜ã‚ã‚‹
              </a>
              <span class="station-note">æœ€å¤§4äººã§åŒæ™‚ãƒ—ãƒ¬ã‚¤</span>
            </div>
          </article>

          <!-- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ -->
          <article class="station-card station-friend">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">FRIEND</div>
              <div class="station-title">
                <span class="station-icon">ğŸ‘¥</span> ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ
              </div>
            </div>
            <p class="station-body">
              ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã€å‹ã ã¡ã‚„ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆã¨åŒã˜éƒ¨å±‹ã¸ã€‚  
              æ•™å®¤ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã©ã¡ã‚‰ã§ã‚‚ãƒ¯ã‚¤ãƒ¯ã‚¤éŠã¹ã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/room/new" class="btn btn-success pill-btn btn-sm">
                éƒ¨å±‹ã‚’ä½œæˆ
              </a>
              <a href="/quiz/room/join" class="btn btn-outline-success pill-btn btn-sm">
                éƒ¨å±‹ã«å‚åŠ 
              </a>
            </div>
          </article>

          <!-- ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ -->
          <article class="station-card station-challenge">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">CPU</div>
              <div class="station-title">
                <span class="station-icon">ğŸ”¥</span> ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰
              </div>
            </div>
            <p class="station-body">
              ã€Œã‚¸ãƒ£ãƒƒã‚¯ã€ã€Œã‚¯ã‚¤ãƒ¼ãƒ³ã€ã€Œã‚­ãƒ³ã‚°ã€ã‹ã‚‰é›£æ˜“åº¦ã‚’é¸æŠã€‚  
              ãã‚Œãã‚Œæ€§èƒ½ã®é•ã†CPUã¨ 1 vs 1 ã®æ—©æŠ¼ã—ãƒãƒˆãƒ«ãŒã§ãã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/challenge" class="btn btn-warning pill-btn btn-sm">
                é›£æ˜“åº¦ã‚’ãˆã‚‰ã¶
              </a>
              <span class="station-note">
                Jack ã¯ã‚„ã•ã—ã‚ã€King ã¯ã‹ãªã‚Šæ‰‹ã”ã‚ã„è¨­å®šã§ã™ã€‚
              </span>
            </div>
          </article>

          <!-- ãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ— -->
          <article class="station-card station-map">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">MAP</div>
              <div class="station-title">
                <span class="station-icon">ğŸ“</span> ãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆ
              </div>
            </div>
            <p class="station-body">
              å®Ÿéš›ã«å…¬åœ’ã‚„å…¬å…±æ–½è¨­ã¸è¡Œã£ã¦ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã€‚  
              è¨ªã‚ŒãŸå ´æ‰€ã«å¿œã˜ã¦ã‚¹ã‚¿ãƒ³ãƒ—ãŒè§£æ”¾ã•ã‚Œã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒå¢—ãˆã¦ã„ãã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/map" class="btn btn-outline-primary pill-btn btn-sm">
                ãƒãƒƒãƒ—ã‚’é–‹ã
              </a>
              <span class="station-note">ä½ç½®æƒ…å ± ON æ¨å¥¨</span>
            </div>
          </article>
        </div>

        <h2 class="section-title">COLLECTION &amp; PROFILE</h2>
        <div class="line-wrapper mb-4">
          <div class="line-core"></div>

          <!-- æ‰€æŒã‚¹ã‚¿ãƒ³ãƒ— -->
          <article class="station-card station-char">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">STAMP</div>
              <div class="station-title">
                <span class="station-icon">ğŸ¦«</span> æ‰€æŒã‚¹ã‚¿ãƒ³ãƒ—
              </div>
            </div>
            <p class="station-body">
              ã“ã‚Œã¾ã§æ‰‹ã«å…¥ã‚ŒãŸã‚¹ã‚¿ãƒ³ãƒ—ã®ä¸€è¦§ã‚’ç¢ºèªã€‚  
              ã©ã®å¸‚ç”ºãƒ»æ–½è¨­ã§ã‚²ãƒƒãƒˆã—ãŸã‹ã‚’æŒ¯ã‚Šè¿”ã‚‹æ¥½ã—ã¿ã‚‚ã€‚
            </p>
            <div class="station-actions">
              <a href="/chars" class="btn btn-outline-primary pill-btn btn-sm">
                ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã‚‹
              </a>
            </div>
          </article>

          <!-- ä½œå•ãƒšãƒ¼ã‚¸ -->
          <article class="station-card station-char">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">MAKE</div>
              <div class="station-title">
                <span class="station-icon">âœï¸</span> ä½œå•
              </div>
            </div>
            <p class="station-body">
              ã‚ãªãŸã®ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆã‚„ãƒ­ãƒ¼ã‚«ãƒ«çŸ¥è­˜ã‚’ã€ã‚¯ã‚¤ã‚ºã®1å•ã¨ã—ã¦ç™»éŒ²ã€‚  
              ã¿ã‚“ãªã§ã€ŒçŸ³å·ã‚¯ã‚¤ã‚ºå›³é‘‘ã€ã‚’è‚²ã¦ã¦ã„ããƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/maker" class="btn btn-outline-dark pill-btn btn-sm">
                ä½œå•ãƒšãƒ¼ã‚¸ã¸
              </a>
            </div>
          </article>

          <!-- åå‰ã®æ±ºå®šãƒ»å¤‰æ›´ -->
          <article class="station-card station-name">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">NAME</div>
              <div class="station-title">
                <span class="station-icon">ğŸ·ï¸</span> åå‰ã®æ±ºå®šãƒ»å¤‰æ›´
              </div>
            </div>
            <p class="station-body mb-1">
              å¯¾æˆ¦ä¸­ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’è¨­å®šãƒ»å¤‰æ›´ã§ãã¾ã™ã€‚
            </p>
            <p class="station-body" style="font-size:.78rem; color:#9ca3af;">
              ç¾åœ¨ã®åå‰ï¼š
              <strong>{{ user.display_name or 'æœªè¨­å®šï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰' }}</strong>
            </p>
            <div class="station-actions">
              <a href="/name" class="btn btn-outline-secondary pill-btn btn-sm">
                åå‰ã‚’æ±ºã‚ã‚‹ / å¤‰æ›´ã™ã‚‹
              </a>
            </div>
          </article>
        </div>

        {% if user.role in ["admin", "researcher"] %}
        <h2 class="section-title">ANALYTICS LINE</h2>
        <div class="line-wrapper">
          <div class="line-core"></div>

          <!-- èªçŸ¥ç‡ãƒ‡ãƒ¼ã‚¿ -->
          <article class="station-card station-analytics">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">DATA</div>
              <div class="station-title">
                <span class="station-icon">ğŸ“Š</span> ãƒ‡ãƒ¼ã‚¿æä¾›ï¼ˆèªçŸ¥ç‡ï¼‰
              </div>
            </div>
            <p class="station-body">
              ã‚¯ã‚¤ã‚ºã®æ­£è§£ï¼ä¸æ­£è§£ã‹ã‚‰ã€æ–½è¨­åˆ¥ãƒ»å¸‚ç”ºåˆ¥ã®ã€ŒèªçŸ¥ç‡ã€ã‚’é›†è¨ˆã€‚  
              ä»®æƒ³ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¯ãƒ¼ã‚¯ã®çµæœã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚„CSVã§ç¢ºèªã§ãã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/recognition" class="btn btn-outline-primary pill-btn btn-sm">
                èªçŸ¥ç‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
              </a>
              <a href="/api/recognition/export.csv" class="btn btn-outline-secondary pill-btn btn-sm">
                CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
              </a>
            </div>
          </article>

          <!-- ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ -->
          <article class="station-card station-analytics">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">DATA</div>
              <div class="station-title">
                <span class="station-icon">ğŸ—‚ï¸</span> ãƒ‡ãƒ¼ã‚¿æä¾›ãã®ï¼’ï¼ˆãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ï¼‰
              </div>
            </div>
            <p class="station-body">
              æ–½è¨­ã”ã¨ã®ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ•°ã‚’æœŸé–“åˆ¥ã«é›†è¨ˆã—ã€  
              åˆ©ç”¨å®Ÿæ…‹ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã®ç°¡æ˜“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨CSVã‚’æä¾›ã—ã¾ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/api/checkins/summary" class="btn btn-outline-primary pill-btn btn-sm">
                ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
              </a>
              <a href="/api/export/checkins_summary.csv" class="btn btn-outline-secondary pill-btn btn-sm">
                CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
              </a>
            </div>
          </article>

          {% if user.role in ["admin"] %}
          <!-- ä½œå•ç·¨é›†ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ -->
          <article class="station-card station-admin">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">ADMIN</div>
              <div class="station-title">
                <span class="station-icon">ğŸ› ï¸</span> ä½œå•ç·¨é›†
              </div>
            </div>
            <p class="station-body">
              ã¿ã‚“ãªãŒç™»éŒ²ã—ãŸã‚ªãƒªã‚¸ãƒŠãƒ«å•é¡Œã‚’ä¸€è¦§ã—ã€ä¸é©åˆ‡ãªå•é¡Œã‚’å‰Šé™¤ã§ãã¾ã™ã€‚  
              æˆæ¥­ã‚„ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚ã‚ã›ã¦ã€å•é¡Œãƒ—ãƒ¼ãƒ«ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã™ã‚‹ç®¡ç†ç”¨ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
            </p>
            <div class="station-actions">
              <a href="/quiz/maker/admin" class="btn btn-outline-danger pill-btn btn-sm">
                ä½œå•ç·¨é›†ãƒšãƒ¼ã‚¸ã¸
              </a>
              <span class="station-note">â€» ç®¡ç†è€…å°‚ç”¨æ©Ÿèƒ½</span>
            </div>
          </article>

          <!-- ç®¡ç†è€…æ¨©é™ã®ä»˜ä¸ãƒ»å¤‰æ›´ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ -->
          <article class="station-card station-admin">
            <div class="station-node"></div>
            <div class="station-header">
              <div class="station-sign">ROLE</div>
              <div class="station-title">
                <span class="station-icon">ğŸ”‘</span> ç®¡ç†è€…æ¨©é™ã®è¨­å®š
              </div>
            </div>
            <p class="station-body">
              æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ï¼ˆroleï¼‰ã‚’ <code>admin</code> / <code>researcher</code> / <code>normal</code> ã«å¤‰æ›´ã§ãã¾ã™ã€‚  
              ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é–“é•ãˆãªã„ã‚ˆã†æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
            </p>
            <div class="station-actions" style="flex-direction: column; align-items: stretch; gap: .5rem;">
              <form id="roleForm" class="row g-2 align-items-end">
                <div class="col-12 col-md-6">
                  <label class="form-label mb-1 small">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                  <input type="email" class="form-control form-control-sm" id="roleEmail" placeholder="user@example.com" required>
                </div>
                <div class="col-6 col-md-3">
                  <label class="form-label mb-1 small">ãƒ­ãƒ¼ãƒ«</label>
                  <select class="form-select form-select-sm" id="roleValue" required>
                    <option value="normal">normalï¼ˆä¸€èˆ¬ï¼‰</option>
                    <option value="researcher">researcherï¼ˆåˆ†æè€…ï¼‰</option>
                    <option value="admin">adminï¼ˆç®¡ç†è€…ï¼‰</option>
                  </select>
                </div>
                <div class="col-6 col-md-3 d-grid">
                  <button type="submit" class="btn btn-sm btn-primary pill-btn" id="roleSubmitBtn">
                    æ¨©é™ã‚’æ›´æ–°ã™ã‚‹
                  </button>
                </div>
              </form>
              <div class="station-note" id="roleResult" style="min-height:1.2em;">
                <!-- çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
              </div>
            </div>
          </article>
          {% endif %}
        </div>
        {% endif %}
      </section>
    </div>
  </main>

  <!-- HOME ç”¨ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="homeTutorialBackdrop" class="home-tutorial-backdrop">
    <div class="home-tutorial-card">
      <div class="home-tutorial-header">
        <div class="home-tutorial-badge">HOW TO PLAY</div>
        <div class="home-tutorial-title">
          <span>ã¯ã˜ã‚ã¦ã®æ–¹ã¸</span>
        </div>
      </div>
      <p class="text-muted small mb-3">
        ã“ã®ã‚¢ãƒ—ãƒªã¯ã€<b>æ—©æŠ¼ã—ã‚¯ã‚¤ã‚º</b>ã¨<b>ãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—</b>ã‚’çµ„ã¿åˆã‚ã›ã¦ã€çŸ³å·ã®å…¬å…±æ–½è¨­ãƒ»å…¬åœ’ã‚’ã‚‚ã£ã¨èº«è¿‘ã«æ„Ÿã˜ã¦ã‚‚ã‚‰ã†ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
      </p>

      <div class="home-tutorial-body">
        <!-- ãƒšãƒ¼ã‚¸1ï¼šå…¨ä½“åƒ -->
        <div class="home-tutorial-page" data-page="1">
          <h3 class="h6 mb-2">â‘  ã©ã‚“ãªã‚¢ãƒ—ãƒªï¼Ÿ</h3>
          <ul class="home-tutorial-list">
            <li><b>æ—©æŠ¼ã—ã‚¯ã‚¤ã‚º</b>ã§ã€å…¬å…±æ–½è¨­ãƒ»å…¬åœ’ã®åå‰ã‚„å ´æ‰€ãƒ»ç‰¹å¾´ã‚’æ¥½ã—ãå­¦ã¹ã¾ã™ã€‚</li>
            <li><b>ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ</b>ã§å…¨å›½ã®èª°ã‹ã¨ã€<b>ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ</b>ã§å‹é”åŒå£«ã¨å¯¾æˆ¦ã§ãã¾ã™ã€‚</li>
            <li><b>ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰</b>ã§ã¯ CPUãƒœã‚¹ï¼ˆã‚¸ãƒ£ãƒƒã‚¯ãƒ»ã‚¯ã‚¤ãƒ¼ãƒ³ãƒ»ã‚­ãƒ³ã‚°ï¼‰ã¨ 1 vs 1 ã§ãƒãƒˆãƒ«ï¼</li>
            <li><b>ã€Œãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆã€</b>ã‹ã‚‰åœ°å›³ã‚’é–‹ãã€å®Ÿéš›ã«å…¬åœ’ã‚„å…¬å…±æ–½è¨­ã¸è¡Œã£ã¦
              <b>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³</b>ã™ã‚‹ã¨ã€ã‚¯ã‚¤ã‚ºä¸­ã«ä½¿ãˆã‚‹ã‚¹ã‚¿ãƒ³ãƒ—ãŒå¢—ãˆã¦ã„ãã¾ã™ã€‚</li>        
          </ul>
          <p class="small text-muted mb-0">
            ã¾ãšã¯ã€ŒPLAY LINEã€ã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ã€éŠã³ãŸã„ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚
          </p>
        </div>

        <!-- ãƒšãƒ¼ã‚¸2ï¼šã‚¯ã‚¤ã‚ºã§éŠã¶ -->
        <div class="home-tutorial-page" data-page="2">
          <h3 class="h6 mb-2">â‘¡ ã‚¯ã‚¤ã‚ºã®éŠã³ã‹ãŸ</h3>
          <ul class="home-tutorial-list">
            <li><b>ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒ</b>â€¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åŒå£«ã§è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°ã—ã¦å¯¾æˆ¦ã—ã¾ã™ã€‚</li>
            <li><b>ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ</b>â€¦éƒ¨å±‹ã‚³ãƒ¼ãƒ‰ã‚’å…±æœ‰ã—ã¦ã€å‹é”ã ã‘ã§éŠã¹ã¾ã™ã€‚</li>
            <li><b>ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰</b>â€¦CPUãƒœã‚¹ã¨ 1å¯¾1ã€‚æ—©ãæ­£è§£ã™ã‚‹ã¨ãƒœã‚¹ã®HPã‚’å‰Šã‚Œã¾ã™ã€‚</li>
          </ul>
          <p class="small text-muted mb-1">
            4æŠã‹ã‚‰ç´ æ—©ãæ­£è§£ã‚’é¸ã¶ã»ã©ã‚¹ã‚³ã‚¢ãŒä¼¸ã³ã¾ã™ã€‚<br>
            å¯¾æˆ¦ä¸­ã¯ã€Œã‚¹ã‚¿ãƒ³ãƒ—ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ãƒ³ãƒ—ã‚‚é€ã‚Œã¾ã™ã€‚
          </p>
        </div>

        <!-- ãƒšãƒ¼ã‚¸3ï¼šãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—ãƒ»ä½œå• -->
        <div class="home-tutorial-page" data-page="3">
          <h3 class="h6 mb-2">â‘¢ ãƒãƒƒãƒ—ã§ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã‚‹ãƒ»å•é¡Œã‚’ä½œã‚‹</h3>
          <ul class="home-tutorial-list">
            <li><b>ãƒãƒƒãƒ—ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆ</b>ã‹ã‚‰åœ°å›³ã‚’é–‹ãã€å®Ÿéš›ã«å…¬åœ’ã‚„å…¬å…±æ–½è¨­ã¸è¡Œã£ã¦<b>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³</b>ã§ãã¾ã™ã€‚</li>
            <li>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã™ã‚‹ã¨ã€ã‚¯ã‚¤ã‚ºã§ä½¿ãˆã‚‹<b>ã‚¹ã‚¿ãƒ³ãƒ—</b>ãŒå¢—ãˆã¦ã„ãã¾ã™ã€‚</li>
            <li><b>ä½œå•</b>ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€è‡ªåˆ†ã§ã‚¯ã‚¤ã‚ºå•é¡Œã‚’ä½œã£ã¦ç™»éŒ²ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</li>
          </ul>
          <p class="small text-muted mb-0">
            ã€ŒéŠã¶ â†’ è¡Œã£ã¦ã¿ã‚‹ â†’ è‡ªåˆ†ã§ä½œã‚‹ã€ã¨ã„ã†æµã‚Œã§ã€åœ°åŸŸã®é­…åŠ›ã‚’æ·±ãçŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
          </p>
        </div>
      </div>

      <div class="home-tutorial-footer">
        <div>
          <div class="form-check form-check-inline mb-1">
            <input class="form-check-input" type="checkbox" value="1" id="homeTutorialDontShow">
            <label class="form-check-label small" for="homeTutorialDontShow">
              æ¬¡å›ã‹ã‚‰è‡ªå‹•è¡¨ç¤ºã—ãªã„
            </label>
          </div>
          <div class="home-tutorial-steps">
            ã‚¹ãƒ†ãƒƒãƒ— <span id="homeTutorialStepLabel">1 / 3</span>
          </div>
        </div>
        <div class="home-tutorial-actions">
          <button id="homeTutorialPrevBtn" class="btn btn-sm btn-outline-secondary me-1">
            â† æˆ»ã‚‹
          </button>
          <button id="homeTutorialNextBtn" class="btn btn-sm btn-primary">
            æ¬¡ã¸ â†’
          </button>
          <button id="homeTutorialCloseBtn" class="btn btn-sm btnæˆåŠŸ" style="display:none;">
            OKã€ã¯ã˜ã‚ã‚‹
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ã‚¢ãƒ—ãƒªå…¨ä½“ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal fade" id="appFeedbackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: 1rem;">
        <div class="modal-header">
          <h5 class="modal-title">ã“ã®ã‚¢ãƒ—ãƒªã¸ã®ã”æ„è¦‹</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é–‰ã˜ã‚‹"></button>
        </div>
        <div class="modal-body">
          <p class="small text-muted">
            Ishikawa Facilities &amp; Parks å…¨ä½“ã«ã¤ã„ã¦ã€æ°—ã¥ã„ãŸã“ã¨ã‚„æ”¹å–„ã—ã¦ã»ã—ã„ç‚¹ãªã©ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ã€‚<br>
            ï¼ˆ<b>ä»»æ„ãƒ»åŒ¿å</b>ã§ã™ãŒã€ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ã²ã‚‚ä»˜ãã§ä¿å­˜ã•ã‚Œã¾ã™ï¼‰
          </p>

          <form id="appFeedbackForm" class="mt-2">
            <div class="mb-3">
              <label class="form-label small">ã“ã®ã‚¢ãƒ—ãƒªã®ã€Œä½¿ã„ã‚„ã™ã•ã€ã¯ã©ã†ã§ã—ãŸã‹ï¼Ÿ</label>
              <select id="appFeedbackRating" class="form-select form-select-sm" required>
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="4">ã¨ã¦ã‚‚ä½¿ã„ã‚„ã™ã„</option>
                <option value="3">ã ã„ãŸã„ä½¿ã„ã‚„ã™ã„</option>
                <option value="2">å°‘ã—ä½¿ã„ã¥ã‚‰ã„</option>
                <option value="1">ã‹ãªã‚Šä½¿ã„ã¥ã‚‰ã„</option>
              </select>
            </div>

            <div class="mb-2">
              <label class="form-label small">
                ã”æ„è¦‹ãƒ»ã”æ„Ÿæƒ³
                <span class="text-muted">(å¿…é ˆ)</span>
              </label>
              <textarea
                id="appFeedbackComment"
                class="form-control"
                rows="4"
                maxlength="1000"
                required
                placeholder="ä¾‹ï¼‰ã‚¹ãƒãƒ›ã§â—‹â—‹ã®ãƒœã‚¿ãƒ³ãŒæŠ¼ã—ã¥ã‚‰ã‹ã£ãŸï¼ã“ã“ãŒè‰¯ã‹ã£ãŸï¼ã“ã‚“ãªæ©Ÿèƒ½ãŒã»ã—ã„ ãªã©"
              ></textarea>
            </div>

            <div id="appFeedbackMsg" class="small mt-1" style="min-height:1.2em;"></div>
          </form>
        </div>
        <div class="modal-footer justify-content-end">
          {% if user and user.role == "admin" %}
            <a href="/admin/app_feedback"
              class="btn btn-outline-danger btn-sm me-2">
              ğŸ›  ç®¡ç†è€…ï¼šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¸€è¦§
            </a>
          {% endif %}

          <button type="button"
                  class="btn btn-outline-secondary btn-sm me-2"
                  data-bs-dismiss="modal"
                  id="appFeedbackCloseBtn">
            é–‰ã˜ã‚‹
          </button>

          <button type="submit"
                  form="appFeedbackForm"
                  class="btn btn-primary btn-sm"
                  id="appFeedbackSubmit">
            é€ä¿¡ã™ã‚‹
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center text-muted mt-4 mb-3" style="font-size:0.85rem;">
    BGM: MusMusï¼ˆãƒ•ãƒªãƒ¼BGMãƒ»éŸ³æ¥½ç´ æ <a href="https://musmus.main.jp" target="_blank">https://musmus.main.jp</a>ï¼‰
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- BGMåˆ¶å¾¡ -->
  <script>
    (function () {
      const audio = document.getElementById("bgmAudio");
      const btn   = document.getElementById("bgmToggleBtn");
      if (!audio || !btn) return;

      audio.volume = 0.5;
      const STORAGE_KEY = "ifp_bgm_enabled";

      let enabled = localStorage.getItem(STORAGE_KEY);
      enabled = (enabled === null) ? true : (enabled === "true");

      const updateButtonText = () => {
        btn.textContent = enabled ? "ğŸµ BGM ON" : "ğŸ”‡ BGM OFF";
      };

      const playIfAllowed = async () => {
        if (!enabled) {
          try { audio.pause(); } catch(e) {}
          return;
        }
        try {
          await audio.play();
        } catch (e) {
          console.log("BGM autoplay blocked:", e);
        }
      };

      updateButtonText();

      const onFirstInteract = () => {
        document.removeEventListener("click", onFirstInteract);
        playIfAllowed();
      };
      document.addEventListener("click", onFirstInteract);

      btn.addEventListener("click", async () => {
        enabled = !enabled;
        localStorage.setItem(STORAGE_KEY, String(enabled));
        updateButtonText();
        if (enabled) {
          await playIfAllowed();
        } else {
          audio.pause();
        }
      });
    })();
  </script>

  <!-- HOME ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«åˆ¶å¾¡ -->
  <script>
    (function() {
      const STORAGE_KEY = "ifp_home_tutorial_hide";

      const backdrop   = document.getElementById("homeTutorialBackdrop");
      const helpBtn    = document.getElementById("homeHelpBtn");
      if (!backdrop) return;

      const pages      = Array.from(backdrop.querySelectorAll(".home-tutorial-page"));
      const prevBtn    = document.getElementById("homeTutorialPrevBtn");
      const nextBtn    = document.getElementById("homeTutorialNextBtn");
      const closeBtn   = document.getElementById("homeTutorialCloseBtn");
      const stepLabel  = document.getElementById("homeTutorialStepLabel");
      const dontShowCb = document.getElementById("homeTutorialDontShow");

      if (!pages.length || !prevBtn || !nextBtn || !closeBtn || !stepLabel) return;

      const total = pages.length;
      let currentPage = 1;

      const applyPage = () => {
        pages.forEach((p) => {
          const pageNo = Number(p.dataset.page || "0");
          p.classList.toggle("active", pageNo === currentPage);
        });
        stepLabel.textContent = `${currentPage} / ${total}`;

        prevBtn.disabled = currentPage === 1;
        nextBtn.style.display  = currentPage < total ? "inline-block" : "none";
        closeBtn.style.display = currentPage === total ? "inline-block" : "none";
      };

      const openTutorial = (page = 1) => {
        currentPage = Math.min(Math.max(1, page), total);
        applyPage();
        backdrop.style.display = "flex";
      };

      const closeTutorial = () => {
        backdrop.style.display = "none";
        if (dontShowCb && dontShowCb.checked) {
          try {
            localStorage.setItem(STORAGE_KEY, "true");
          } catch(e) {}
        }
      };

      prevBtn.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage -= 1;
          applyPage();
        }
      });

      nextBtn.addEventListener("click", () => {
        if (currentPage < total) {
          currentPage += 1;
          applyPage();
        }
      });

      closeBtn.addEventListener("click", () => {
        closeTutorial();
      });

      backdrop.addEventListener("click", (ev) => {
        if (ev.target === backdrop) {
          closeTutorial();
        }
      });

      document.addEventListener("keydown", (ev) => {
        if (ev.key === "Escape" && backdrop.style.display !== "none") {
          closeTutorial();
        }
      });

      if (helpBtn) {
        helpBtn.addEventListener("click", () => {
          openTutorial(1);
        });
      }

      try {
        const hide = localStorage.getItem(STORAGE_KEY) === "true";
        if (!hide) {
          openTutorial(1);
        }
      } catch(e) {
        openTutorial(1);
      }
    })();
  </script>

  <!-- æ®¿å ‚å…¥ã‚Šã‚¨ãƒªã‚¢ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼åˆ¶å¾¡ -->
  <script>
    (function() {
      async function loadHallOfFame() {
        const topEl = document.getElementById("hofTopPlayers");
        const kingEl = document.getElementById("hofKingClear");
        if (!topEl || !kingEl) return;

        try {
          const r1 = await fetch("/api/home/top_quiz_players");
          const d1 = await r1.json();
          const items1 = Array.isArray(d1.items) ? d1.items : [];

          if (items1.length === 0) {
            topEl.innerHTML = '<li class="hof-empty">ã¾ã é›†è¨ˆä¸­ã§ã™â€¦ ã‚¯ã‚¤ã‚ºã«å‚åŠ ã—ã¦ã¿ã‚ˆã†ï¼</li>';
          } else {
            topEl.innerHTML = items1.map((p, idx) => {
              const rank = idx + 1;
              const rankPill = (rank <= 3)
                ? `<span class="hof-rank-pill">${rank}</span>`
                : `<span class="hof-rank-pill" style="opacity:.65;">${rank}</span>`;
              return `
                <li>
                  <span class="hof-name">${rankPill}<span>${p.display_name}</span></span>
                  <span class="hof-meta">${p.count} ãƒ—ãƒ¬ã‚¤</span>
                </li>
              `;
            }).join("");
          }

          const r2 = await fetch("/api/home/king_clearers");
          const d2 = await r2.json();
          const items2 = Array.isArray(d2.items) ? d2.items : [];

          if (items2.length === 0) {
            kingEl.innerHTML = '<li class="hof-empty">ã¾ã ã‚­ãƒ³ã‚°ã‚’å€’ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã„ã¾ã›ã‚“ã€‚</li>';
          } else {
            kingEl.innerHTML = items2.map((p, idx) => {
              const rank = idx + 1;
              const rankPill = `<span class="hof-rank-pill">${rank}</span>`;
              return `
                <li>
                  <span class="hof-name">${rankPill}<span>${p.display_name}</span></span>
                  <span class="hof-meta">Kingæ’ƒç ´</span>
                </li>
              `;
            }).join("");
          }

        } catch (e) {
          console.error("hall-of-fame load error:", e);
        }
      }

      function initHallOfFameCarousel() {
        const root = document.querySelector(".hall-of-fame");
        if (!root) return;

        const track = root.querySelector(".hof-track");
        const slides = root.querySelectorAll(".hof-slide");
        const indicators = root.querySelectorAll(".hof-indicator");

        if (!track || slides.length === 0) return;

        let currentIndex = 0;
        const total = slides.length;
        let timerId = null;
        const INTERVAL_MS = 6000;

        const apply = () => {
          track.style.transform = `translateX(-${currentIndex * 100}%)`;
          indicators.forEach((btn, idx) => {
            btn.classList.toggle("active", idx === currentIndex);
          });
        };

        const startAuto = () => {
          stopAuto();
          timerId = setInterval(() => {
            currentIndex = (currentIndex + 1) % total;
            apply();
          }, INTERVAL_MS);
        };

        const stopAuto = () => {
          if (timerId) {
            clearInterval(timerId);
            timerId = null;
          }
        };

        indicators.forEach((btn) => {
          btn.addEventListener("click", () => {
            const idx = Number(btn.dataset.index || "0");
            currentIndex = Math.min(Math.max(idx, 0), total - 1);
            apply();
            startAuto();
          });
        });

        root.addEventListener("mouseenter", stopAuto);
        root.addEventListener("mouseleave", startAuto);

        apply();
        startAuto();
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadHallOfFame();
        initHallOfFameCarousel();
      });
    })();
  </script>

  <!-- ã‚¢ãƒ—ãƒªå…¨ä½“ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡ JS -->
  <script>
    (function() {
      const openBtn   = document.getElementById("appFeedbackBtn");
      const modalEl   = document.getElementById("appFeedbackModal");
      const form      = document.getElementById("appFeedbackForm");
      const ratingSel = document.getElementById("appFeedbackRating");
      const commentEl = document.getElementById("appFeedbackComment");
      const msgEl     = document.getElementById("appFeedbackMsg");
      const submitBtn = document.getElementById("appFeedbackSubmit");

      if (!openBtn || !modalEl || !form || !ratingSel || !commentEl || !msgEl || !submitBtn) return;
      if (typeof bootstrap === "undefined") return;

      const modal = new bootstrap.Modal(modalEl);

      openBtn.addEventListener("click", () => {
        form.reset();
        msgEl.textContent = "";
        msgEl.style.color = "#6b7280";
        submitBtn.disabled = false;
        submitBtn.textContent = "é€ä¿¡ã™ã‚‹";
        modal.show();
      });

      form.addEventListener("submit", async (ev) => {
        ev.preventDefault();

        const rating = Number(ratingSel.value || "0");
        const comment = (commentEl.value || "").trim();

        if (!rating || !comment) {
          msgEl.textContent = "è©•ä¾¡ã¨ã”æ„è¦‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          msgEl.style.color = "#b91c1c";
          return;
        }

        submitBtn.disabled = true;
        const originalText = submitBtn.textContent;
        submitBtn.textContent = "é€ä¿¡ä¸­â€¦";
        msgEl.textContent = "";
        msgEl.style.color = "#6b7280";

        try {
          const res = await fetch("/api/feedback/app", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ rating, comment })
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok || !data.ok) {
            const msg = data.detail || data.message || `é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ï¼ˆHTTP ${res.status}ï¼‰`;
            msgEl.textContent = msg;
            msgEl.style.color = "#b91c1c";
          } else {
            msgEl.textContent = "ã”æ„è¦‹ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼";
            msgEl.style.color = "#166534";
            setTimeout(() => { modal.hide(); }, 800);
          }
        } catch (e) {
          console.error(e);
          msgEl.textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
          msgEl.style.color = "#b91c1c";
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      });
    })();
  </script>

  <!-- ç®¡ç†è€…æ¨©é™ã‚«ãƒ¼ãƒ‰ã® JS -->
  <script>
    (function() {
      const form = document.getElementById("roleForm");
      const emailInput = document.getElementById("roleEmail");
      const roleSelect = document.getElementById("roleValue");
      const resultEl = document.getElementById("roleResult");
      const submitBtn = document.getElementById("roleSubmitBtn");

      if (!form || !emailInput || !roleSelect || !resultEl || !submitBtn) {
        return;
      }

      form.addEventListener("submit", async (ev) => {
        ev.preventDefault();

        const email = emailInput.value.trim();
        const role = roleSelect.value.trim();

        if (!email || !role) {
          resultEl.textContent = "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ­ãƒ¼ãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          resultEl.style.color = "#b91c1c";
          return;
        }

        submitBtn.disabled = true;
        const originalText = submitBtn.textContent;
        submitBtn.textContent = "æ›´æ–°ä¸­â€¦";
        resultEl.textContent = "";
        resultEl.style.color = "#6b7280";

        try {
          const res = await fetch("/admin/set_role", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ email, role })
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok || !data.ok) {
            const msg = data.detail || data.message || `æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ï¼ˆHTTP ${res.status}ï¼‰`;
            resultEl.textContent = msg;
            resultEl.style.color = "#b91c1c";
          } else {
            resultEl.textContent = data.message || "æ¨©é™ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚";
            resultEl.style.color = "#166534";
            roleSelect.value = data.new_role || role;
          }
        } catch (e) {
          console.error(e);
          resultEl.textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
          resultEl.style.color = "#b91c1c";
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      });
    })();
  </script>
</body>
</html>
