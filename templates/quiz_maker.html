<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ä½œå•ãƒ¢ãƒ¼ãƒ‰ | Ishikawa Facilities & Parks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css?v=4">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="navbar">
    <div class="nav-brand">
      <div class="nav-brand-icon">âœï¸</div>
      <div class="nav-brand-title">Quiz Maker</div>
    </div>
    <a href="/home" class="btn btn-sm btn-secondary">ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a>
  </header>

  <main class="container py-8">
    <div class="mb-8 text-center">
      <h1 class="text-3xl font-bold mb-2">ã‚ªãƒªã‚¸ãƒŠãƒ«å•é¡Œã‚’ä½œã‚‹</h1>
      <p class="text-muted">ã‚ãªãŸã®çŸ¥è­˜ã‚’ã¿ã‚“ãªã«å‡ºé¡Œã—ã‚ˆã†ï¼</p>
    </div>

    <div class="flex flex-col gap-6" style="max-width: 800px; margin: 0 auto;">
      
      <div class="card card-purple animate-fade-in">
        <form id="qForm">
          <div class="form-group">
            <label class="form-label">å•é¡Œæ–‡</label>
            <input name="stem" class="input-dark" placeholder="ä¾‹: é‡‘æ²¢é§…ã«ã‚ã‚‹æœ‰åãªé–€ã®åå‰ã¯ï¼Ÿ" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">ãƒ’ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰</label>
            <input name="hint" class="input-dark" placeholder="ä¾‹: ã€Œã¤ã€ã‹ã‚‰å§‹ã¾ã‚‹ã‚ˆ">
          </div>

          <div class="grid-dashboard" style="grid-template-columns: 1fr 1fr; gap:16px;">
            {% for i in range(4) %}
            <div class="form-group">
              <label class="form-label">é¸æŠè‚¢ {{ i+1 }}</label>
              <input type="text" name="choice{{i+1}}" class="input-dark" required>
            </div>
            {% endfor %}
          </div>

          <div class="form-group mt-4">
            <label class="form-label">æ­£è§£ã®ç•ªå·ï¼ˆ1ã€œ4ï¼‰</label>
            <input type="number" name="correct_idx" class="input-dark" min="1" max="4" required style="width:100px;">
          </div>

          <button class="btn btn-white w-full mt-4">ç™»éŒ²ã™ã‚‹</button>
        </form>
      </div>

      <div class="card card-dark animate-fade-in">
        <h2 class="text-xl font-bold mb-4">ä½œæˆã—ãŸå•é¡Œãƒªã‚¹ãƒˆ</h2>
        <div id="myQuestions" class="flex flex-col gap-4">
          </div>
      </div>
    </div>
  </main>

  <script>
    const form = document.getElementById("qForm");
    function esc(s){ return String(s ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const r = await fetch("/api/quiz/maker/add", { method: "POST", body: fd });
      const js = await r.json();
      if (js.ok) {
        // æˆåŠŸæ™‚ã®ãƒˆãƒ¼ã‚¹ãƒˆã®ä»£ã‚ã‚Šã«ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆã¾ãŸã¯toasté–¢æ•°ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†ï¼‰
        alert("ç™»éŒ²ã—ã¾ã—ãŸï¼");
        form.reset();
        loadList();
      } else {
        alert("ã‚¨ãƒ©ãƒ¼: " + (js.error || "ç™»éŒ²å¤±æ•—"));
      }
    });

    async function loadList() {
      const r = await fetch("/api/quiz/maker/list");
      const js = await r.json();
      const list = document.getElementById("myQuestions");
      list.innerHTML = "";
      if (js.ok) {
        if (js.questions.length === 0) {
          list.innerHTML = "<div class='text-muted p-4'>ã¾ã å•é¡Œã‚’ä½œã£ã¦ã„ã¾ã›ã‚“ã€‚</div>";
        } else {
          js.questions.forEach((q) => {
            const div = document.createElement("div");
            div.className = "p-4 rounded border border-gray-700 bg-black/20";
            div.innerHTML = `
              <div class="font-bold mb-1">Q. ${esc(q.stem)}</div>
              <div class="text-sm text-muted mb-2">
                 é¸æŠè‚¢: ${q.choices.map(c => esc(c)).join(" / ")} 
                 <span class="text-primary ml-2">æ­£è§£: ${q.correct_idx + 1}</span>
              </div>
              ${q.hint ? `<div class="text-xs text-blue-400">ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ${esc(q.hint)}</div>` : ''}
            `;
            list.appendChild(div);
          });
        }
      }
    }
    loadList();
  </script>
</body>
</html>